\usepackage[margin=0.5in]{geometry}
\usepackage{calc}

% Configure Source Serif 4 as main font and Source Sans 3 as mono. Adapted from
% https://tex.stackexchange.com/questions/62603/how-to-choose-a-specific-weight-from-a-font-family-using-fontspec-and-xelatex
\usepackage{fontspec}
\defaultfontfeatures{Scale=MatchLowercase}
\setmainfont{Times New Roman}
[Ligatures=TeX,
   Scale=1.0037562139,
   UprightFont=*,
   ItalicFont={* Italic},
   BoldFont={* Bold},
   BoldItalicFont={* Bold Italic},
   FontFace={l}{n}{*},
   FontFace={l}{it}{* Italic},
   FontFace={sb}{n}{* Bold},
   FontFace={sb}{it}{* Bold Italic}
  ]
\DeclareRobustCommand{\ltseries}{\fontseries{l}\selectfont}
\DeclareTextFontCommand{\textlt}{\ltseries}
\DeclareRobustCommand{\sbseries}{\fontseries{sb}\selectfont}
\DeclareTextFontCommand{\textsb}{\sbseries}
% Times New Roman does not have light or semibold weights; use bold weight instead

\setsansfont{Source Sans 3}
  [Ligatures=TeX,
   Scale=1.0037408433,
   UprightFont=*,
   ItalicFont={* Italic},
   BoldFont={* Bold},
   BoldItalicFont={* Bold Italic},
   FontFace={l}{n}{* Light},
   FontFace={l}{it}{* Light Italic},
   FontFace={sb}{n}{* SemiBold},
   FontFace={sb}{it}{* SemiBold Italic},
   FontFace={eb}{n}{* Black},
   FontFace={eb}{it}{* Black Italic}
  ]

\setmonofont{Source Code Pro}[Scale=MatchUppercase]

% Define theme colour:
\usepackage[dvipsnames]{xcolor}
\definecolor{themecolour}{HTML}{00205B} % Pantone 281C

% Change the title font:
\usepackage{titling}
\setlength{\droptitle}{-3.5em}
\pretitle{\vspace{0.25in}\begin{center}\rmfamily\bfseries\color{themecolour}}
\posttitle{\par\end{center}\vspace{-2em}}
\preauthor{}
\author{}
\postauthor{}
\predate{}
\date{}
\postdate{}

% Adjust paragraph spacing:
\newlength{\defaultparindent}
\setlength{\defaultparindent}{\parindent}
\setlength{\parindent}{0em}
\newlength{\defaultparskip}
\setlength{\defaultparskip}{\parskip}
\setlength{\parskip}{1ex}

% Articles generally won't have tables of contents, but this should be compact if requested:
\usepackage[titles]{tocloft}
% Adjust spacing:
\setlength{\cftaftertoctitleskip}{1\parskip}
\setlength{\cftbeforesecskip}{0.5\parskip}
\setlength{\cftsecindent}{0pt}
\setlength{\cftsubsecindent}{1.5em}
\setlength{\cftsubsubsecindent}{1.5em}
% Adjust fonts:
\renewcommand{\cfttoctitlefont}{\LARGE\rmfamily\bfseries\color{themecolour}}
\renewcommand{\cftsecfont}{\normalsize\rmfamily}
\renewcommand{\cftsecpagefont}{\normalsize\rmfamily}
\renewcommand{\cftsubsecfont}{\normalsize\rmfamily\ltseries}
\renewcommand{\cftsubsecpagefont}{\normalsize\rmfamily\ltseries}
\renewcommand{\cftsubsubsecfont}{\normalsize\rmfamily\ltseries\itshape}
\renewcommand{\cftsubsubsecpagefont}{\normalsize\rmfamily\ltseries\itshape}

% Style section headers:
\usepackage{titlesec}
\newcommand{\addperiod}[1]{#1.}
\titleformat{\section}{\normalsize\rmfamily\bfseries\color{themecolour}}{\thetitle.}{0.5em}{}
\titlespacing*{\section}{0pt}{\baselineskip}{-\parskip}
\titleformat{\subsection}{\normalsize\rmfamily\bfseries\itshape\color{themecolour}}{\thetitle.}{0.5em}{}
\titlespacing*{\subsection}{0pt}{\parskip}{-\parskip}
\titleformat{\subsubsection}[runin]{\normalsize\bfseries\color{themecolour}}{\thetitle}{}{\addperiod}
\titlespacing*{\subsubsection}{0pt}{0pt}{1ex}
\titleformat{\paragraph}[runin]{\normalsize\bfseries\itshape}{\thetitle}{}{\addperiod}
\titlespacing{\paragraph}{0pt}{0pt}{1ex}
\titleformat{\subparagraph}[runin]{\normalsize\itshape}{\thetitle}{}{\addperiod}
\titlespacing{\subparagraph}{0pt}{0pt}{1ex}

% Reduce spacing in list environments:
\usepackage{enumitem}
% Align enumerate and itemize items to left margin, remove parsep:
% \setlist[enumerate,itemize]{
%   itemsep=0pt,
%   leftmargin=*,
%   topsep=0pt,
%   parsep=0pt}
% Indent lists by the default value of \parindent:
\setlist[enumerate,itemize]{
  left=\defaultparindent,
  topsep=0pt,
  itemsep=0pt,
  parsep=0pt
}

% Indent description environments:
\setlist[description]{
  font=\bfseries,
  leftmargin=3in,
  itemindent=0in,
  labelwidth=*,
  topsep=0pt,
  parsep=2\parsep
}

\raggedbottom

% Enable hyperlinks for paper URLs:
\usepackage{hyperref}
\hypersetup{
  hyperfootnotes=false,
  colorlinks=true,
  citecolor=themecolour,
  urlcolor=themecolour,
  linkcolor=.
}

% Enable author affiliations:
\usepackage{authblk}

% Allow tables to be scaled:
\usepackage{tabularx}

% Change font for figure labels:
\usepackage[font=normalsize,
            labelfont={color=themecolour,bf},
            justification=justified,singlelinecheck=false]{caption}
\captionsetup[table]{skip=4pt}

% allow for graphics
\usepackage{graphicx}

% Use MS Society header on the first page:
\usepackage{fancyhdr}
\usepackage[absolute]{textpos}

\fancypagestyle{plain}{
  \fancyhf{}
  % \renewcommand{\headheight}{0.5in}
  \fancyhead[L]{%
    \begin{textblock*}{0.878in}[0,1](0.5in,1in-0.0162pt) % adjust to match spacing in template
      \includegraphics*[width=2.23cm]{~/.latex/mssociety_header.png}
    \end{textblock*}}

  \fancyhead[R]{%
    \begin{textblock*}{2.5in}[1,1](8in,0.5in+0.5967in)
      \begin{flushright}%
        \bfseries\itshape\shorttitle%
      \end{flushright}
    \end{textblock*}}

  \fancyfoot[R]{\thepage}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}

% Use a modified fancy style for all other pages:
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[R]{\thepage}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

\usepackage{booktabs}

\usepackage{setspace}

\frenchspacing
